--- origsrc/couchdb-glib-0.7.4/couchdb-glib/Makefile.am	2011-01-19 22:02:49.000000000 +0900
+++ src/couchdb-glib-0.7.4/couchdb-glib/Makefile.am	2025-12-28 20:56:40.043392800 +0900
@@ -74,7 +74,7 @@ libcouchdb_glib_1_0_la_LIBADD =		\
 	$(OAUTH_LIBS)			\
 	-luuid
 
-libcouchdb_glib_1_0_la_LDFLAGS =	\
+libcouchdb_glib_1_0_la_LDFLAGS = -no-undefined	\
 	-version-info $(LIBCOUCHDBGLIB_CURRENT):$(LIBCOUCHDBGLIB_REVISION):$(LIBCOUCHDBGLIB_AGE)
 
 hdir = $(includedir)/couchdb-glib-1.0
--- origsrc/couchdb-glib-0.7.4/couchdb-glib/couchdb-marshal.c	2011-08-23 00:52:33.000000000 +0900
+++ src/couchdb-glib-0.7.4/couchdb-glib/couchdb-marshal.c	2025-12-28 20:16:14.710927800 +0900
@@ -1,10 +1,9 @@
-
-#include	<glib-object.h>
-
+/* This file is generated by glib-genmarshal, do not modify it. This code is licensed under the same license as the containing project. Note that it links to GLib, so must comply with the LGPL linking clauses. */
+#include <glib-object.h>
 
 #ifdef G_ENABLE_DEBUG
 #define g_marshal_value_peek_boolean(v)  g_value_get_boolean (v)
-#define g_marshal_value_peek_char(v)     g_value_get_char (v)
+#define g_marshal_value_peek_char(v)     g_value_get_schar (v)
 #define g_marshal_value_peek_uchar(v)    g_value_get_uchar (v)
 #define g_marshal_value_peek_int(v)      g_value_get_int (v)
 #define g_marshal_value_peek_uint(v)     g_value_get_uint (v)
@@ -48,8 +47,7 @@
 #define g_marshal_value_peek_variant(v)  (v)->data[0].v_pointer
 #endif /* !G_ENABLE_DEBUG */
 
-
-/* NONE:STRING,OBJECT (couchdb-marshal.list:1) */
+/* NONE:STRING,OBJECT (/tmp/couchdb-glib/couchdb-glib-0.7.4-1bl1.x86_64/src/couchdb-glib-0.7.4/couchdb-glib/couchdb-marshal.list:1) */
 void
 _couchdb_marshal_VOID__STRING_OBJECT (GClosure     *closure,
                                       GValue       *return_value G_GNUC_UNUSED,
@@ -58,13 +56,13 @@ _couchdb_marshal_VOID__STRING_OBJECT (GC
                                       gpointer      invocation_hint G_GNUC_UNUSED,
                                       gpointer      marshal_data)
 {
-  typedef void (*GMarshalFunc_VOID__STRING_OBJECT) (gpointer     data1,
-                                                    gpointer     arg_1,
-                                                    gpointer     arg_2,
-                                                    gpointer     data2);
-  register GMarshalFunc_VOID__STRING_OBJECT callback;
-  register GCClosure *cc = (GCClosure*) closure;
-  register gpointer data1, data2;
+  typedef void (*GMarshalFunc_VOID__STRING_OBJECT) (gpointer data1,
+                                                    gpointer arg1,
+                                                    gpointer arg2,
+                                                    gpointer data2);
+  GCClosure *cc = (GCClosure *) closure;
+  gpointer data1, data2;
+  GMarshalFunc_VOID__STRING_OBJECT callback;
 
   g_return_if_fail (n_param_values == 3);
 
@@ -86,7 +84,7 @@ _couchdb_marshal_VOID__STRING_OBJECT (GC
             data2);
 }
 
-/* NONE:STRING,STRING (couchdb-marshal.list:2) */
+/* NONE:STRING,STRING (/tmp/couchdb-glib/couchdb-glib-0.7.4-1bl1.x86_64/src/couchdb-glib-0.7.4/couchdb-glib/couchdb-marshal.list:2) */
 void
 _couchdb_marshal_VOID__STRING_STRING (GClosure     *closure,
                                       GValue       *return_value G_GNUC_UNUSED,
@@ -95,13 +93,13 @@ _couchdb_marshal_VOID__STRING_STRING (GC
                                       gpointer      invocation_hint G_GNUC_UNUSED,
                                       gpointer      marshal_data)
 {
-  typedef void (*GMarshalFunc_VOID__STRING_STRING) (gpointer     data1,
-                                                    gpointer     arg_1,
-                                                    gpointer     arg_2,
-                                                    gpointer     data2);
-  register GMarshalFunc_VOID__STRING_STRING callback;
-  register GCClosure *cc = (GCClosure*) closure;
-  register gpointer data1, data2;
+  typedef void (*GMarshalFunc_VOID__STRING_STRING) (gpointer data1,
+                                                    gpointer arg1,
+                                                    gpointer arg2,
+                                                    gpointer data2);
+  GCClosure *cc = (GCClosure *) closure;
+  gpointer data1, data2;
+  GMarshalFunc_VOID__STRING_STRING callback;
 
   g_return_if_fail (n_param_values == 3);
 
--- origsrc/couchdb-glib-0.7.4/couchdb-glib/xmalloc.h	2010-04-13 16:51:24.000000000 +0900
+++ src/couchdb-glib-0.7.4/couchdb-glib/xmalloc.h	2025-12-28 20:22:26.627250700 +0900
@@ -5,8 +5,10 @@ void *xcalloc (size_t n, size_t s);
 void *xrealloc (void *p, size_t n);
 char *xstrdup (const char *p);
 
+#if !defined(__CYGWIN__)
 /* POSIX prototypes - avoid compiler warnings with '-posix' */
 int strncasecmp(const char *s1, const char *s2, size_t n);
 int snprintf(char *str, size_t size, const char *format, ...);
 FILE *popen(const char *command, const char *type);
 int pclose(FILE *stream);
+#endif
--- origsrc/couchdb-glib-0.7.4/desktopcouch-glib/Makefile.am	2011-07-22 18:00:51.000000000 +0900
+++ src/couchdb-glib-0.7.4/desktopcouch-glib/Makefile.am	2025-12-28 21:05:17.903673300 +0900
@@ -22,7 +22,7 @@ libdesktopcouch_glib_1_0_la_LIBADD =
 	$(COUCHDB_GLIB_LIBS)					\
 	$(DESKTOPCOUCH_GLIB_LIBS)
 
-libdesktopcouch_glib_1_0_la_LDFLAGS =	\
+libdesktopcouch_glib_1_0_la_LDFLAGS = -no-undefined	\
 	-version-info $(LIBCOUCHDBGLIB_CURRENT):$(LIBCOUCHDBGLIB_REVISION):$(LIBCOUCHDBGLIB_AGE)
 
 hdir = $(includedir)/desktopcouch-glib-1.0
@@ -32,7 +32,7 @@ h_DATA = 				\
 
 -include $(INTROSPECTION_MAKEFILE)
 INTROSPECTION_GIRS =
-INTROSPECTION_SCANNER_ARGS = --add-include-path=$(srcdir) --add-include-path=$(top_srcdir)/couchdb-glib
+INTROSPECTION_SCANNER_ARGS = --add-include-path=$(srcdir) --add-include-path=$(top_srcdir)/couchdb-glib --add-include-path=$(top_builddir)/couchdb-glib
 INTROSPECTION_COMPILER_ARGS = --includedir=$(srcdir) --includedir=$(top_builddir)/couchdb-glib
 
 if HAVE_INTROSPECTION
--- origsrc/couchdb-glib-0.7.4/tests/test-couchdb-glib.c	2011-03-25 00:42:20.000000000 +0900
+++ src/couchdb-glib-0.7.4/tests/test-couchdb-glib.c	2025-12-28 21:07:13.234716300 +0900
@@ -275,7 +275,6 @@ int
 main (int argc, char *argv[])
 {
 	g_type_init ();
-	g_thread_init (NULL);
 	g_test_init (&argc, &argv, NULL);
 
 	/* Initialize data needed for all tests */
--- origsrc/couchdb-glib-0.7.4/tests/test-desktopcouch-glib.c	2011-04-01 23:27:45.000000000 +0900
+++ src/couchdb-glib-0.7.4/tests/test-desktopcouch-glib.c	2025-12-28 21:08:09.720363500 +0900
@@ -45,9 +45,6 @@ test_connect_thread (void)
 {
 	GThread *thread;
 
-	if (!g_thread_get_initialized ())
-		g_thread_init (NULL);
-
 	thread = g_thread_create ((GThreadFunc) connect_thread, NULL, TRUE, NULL);
 	g_assert (g_thread_join (thread));
 }
@@ -107,7 +104,6 @@ int
 main (int argc, char *argv[])
 {
 	g_type_init ();
-	g_thread_init (NULL);
 	g_test_init (&argc, &argv, NULL);
 
 	g_test_add_func ("/testdesktopcouchglib/Connect", test_connect_desktopcouch);
--- origsrc/couchdb-glib-0.7.4/tests/test-list-databases.c	2011-03-25 00:41:06.000000000 +0900
+++ src/couchdb-glib-0.7.4/tests/test-list-databases.c	2025-12-28 21:10:10.315561000 +0900
@@ -30,7 +30,6 @@ main (int argc, char *argv[])
 
 
 	g_type_init ();
-	g_thread_init (NULL);
 
 	/* Initialize Couchdb */
 	couchdb =  argc > 1 ? couchdb_session_new (argv[1]) : couchdb_session_new (NULL);
--- origsrc/couchdb-glib-0.7.4/tests/test-oauth.c	2011-02-08 01:04:26.000000000 +0900
+++ src/couchdb-glib-0.7.4/tests/test-oauth.c	2025-12-28 21:10:50.403360100 +0900
@@ -110,7 +110,6 @@ main (int argc, char *argv[])
 
 	/* Now connecting to Couchdb with this OAuth stuff */
 	g_type_init ();
-	g_thread_init (NULL);
 
 	couchdb = couchdb_session_new (url);
 	credentials = couchdb_credentials_new_with_oauth (c_key, c_secret, t_key, t_secret);
