--- origsrc/lace-2.0.3/CMakeLists.txt	2025-08-05 20:39:43.000000000 +0900
+++ src/lace-2.0.3/CMakeLists.txt	2025-12-25 20:10:10.923215100 +0900
@@ -25,15 +25,15 @@ if(LACE_USE_MMAP)
     endif()
 endif()
 
-add_library(lace STATIC
+add_library(lace SHARED
     ${CMAKE_CURRENT_SOURCE_DIR}/src/lace.c
     ${CMAKE_CURRENT_SOURCE_DIR}/src/lace.h
 )
-add_library(lace32 STATIC
+add_library(lace32 SHARED
     ${CMAKE_CURRENT_SOURCE_DIR}/src/lace32.c
     ${CMAKE_CURRENT_SOURCE_DIR}/src/lace32.h
 )
-add_library(lace128 STATIC
+add_library(lace128 SHARED
     ${CMAKE_CURRENT_SOURCE_DIR}/src/lace128.c
     ${CMAKE_CURRENT_SOURCE_DIR}/src/lace128.h
 )
@@ -140,6 +140,12 @@ set_target_properties(lace128 PROPERTIES
     RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/bin
 )
 
+if(DEFINED SOVERSION)
+    set_target_properties(lace PROPERTIES SOVERSION "${SOVERSION}")
+    set_target_properties(lace32 PROPERTIES SOVERSION "${SOVERSION}")
+    set_target_properties(lace128 PROPERTIES SOVERSION "${SOVERSION}")
+endif()
+
 configure_file(src/lace_config.h.in ${CMAKE_CURRENT_BINARY_DIR}/lace_config.h @ONLY)
 
 if(CMAKE_CURRENT_SOURCE_DIR STREQUAL CMAKE_SOURCE_DIR)
--- origsrc/lace-2.0.3/src/lace.c	2025-08-05 20:39:43.000000000 +0900
+++ src/lace-2.0.3/src/lace.c	2025-12-25 21:05:15.779486400 +0900
@@ -374,7 +374,7 @@ lace_init_worker(unsigned int worker)
         exit(1);
     }
 #else
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     workers_memory[worker] = _aligned_malloc(workers_memory_size, cache_line_size);
 #elif defined(__MINGW32__)
     workers_memory[worker] = __mingw_aligned_malloc(workers_memory_size, cache_line_size);
@@ -836,7 +836,7 @@ lace_start(unsigned int _n_workers, size
     // first make sure that the amount to allocate (n_workers times pointer) is a multiple of cache_line_size
     size_t to_allocate = n_workers * sizeof(void*);
     to_allocate = (to_allocate+cache_line_size-1) & (~(cache_line_size-1));
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     workers = _aligned_malloc(to_allocate, cache_line_size);
     workers_p = _aligned_malloc(to_allocate, cache_line_size);
     workers_memory = _aligned_malloc(to_allocate, cache_line_size);
@@ -1098,7 +1098,7 @@ void lace_stop()
     for (unsigned int i=0; i<n_workers; i++) {
 #if LACE_USE_MMAP
         munmap(workers_memory[i], workers_memory_size);
-#elif defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#elif (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
 	_aligned_free(workers_memory[i]);
 #elif defined(__MINGW32__)
 	__mingw_aligned_free(workers_memory[i]);
@@ -1107,7 +1107,7 @@ void lace_stop()
 #endif
     }
 
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     _aligned_free(workers);
     _aligned_free(workers_p);
     _aligned_free(workers_memory);
--- origsrc/lace-2.0.3/src/lace128.c	2025-08-05 20:39:43.000000000 +0900
+++ src/lace-2.0.3/src/lace128.c	2025-12-25 21:05:14.726216900 +0900
@@ -374,7 +374,7 @@ lace_init_worker(unsigned int worker)
         exit(1);
     }
 #else
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     workers_memory[worker] = _aligned_malloc(workers_memory_size, cache_line_size);
 #elif defined(__MINGW32__)
     workers_memory[worker] = __mingw_aligned_malloc(workers_memory_size, cache_line_size);
@@ -836,7 +836,7 @@ lace_start(unsigned int _n_workers, size
     // first make sure that the amount to allocate (n_workers times pointer) is a multiple of cache_line_size
     size_t to_allocate = n_workers * sizeof(void*);
     to_allocate = (to_allocate+cache_line_size-1) & (~(cache_line_size-1));
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     workers = _aligned_malloc(to_allocate, cache_line_size);
     workers_p = _aligned_malloc(to_allocate, cache_line_size);
     workers_memory = _aligned_malloc(to_allocate, cache_line_size);
@@ -1098,7 +1098,7 @@ void lace_stop()
     for (unsigned int i=0; i<n_workers; i++) {
 #if LACE_USE_MMAP
         munmap(workers_memory[i], workers_memory_size);
-#elif defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#elif (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
 	_aligned_free(workers_memory[i]);
 #elif defined(__MINGW32__)
 	__mingw_aligned_free(workers_memory[i]);
@@ -1107,7 +1107,7 @@ void lace_stop()
 #endif
     }
 
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     _aligned_free(workers);
     _aligned_free(workers_p);
     _aligned_free(workers_memory);
--- origsrc/lace-2.0.3/src/lace32.c	2025-08-05 20:39:43.000000000 +0900
+++ src/lace-2.0.3/src/lace32.c	2025-12-25 21:05:14.729797500 +0900
@@ -374,7 +374,7 @@ lace_init_worker(unsigned int worker)
         exit(1);
     }
 #else
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     workers_memory[worker] = _aligned_malloc(workers_memory_size, cache_line_size);
 #elif defined(__MINGW32__)
     workers_memory[worker] = __mingw_aligned_malloc(workers_memory_size, cache_line_size);
@@ -836,7 +836,7 @@ lace_start(unsigned int _n_workers, size
     // first make sure that the amount to allocate (n_workers times pointer) is a multiple of cache_line_size
     size_t to_allocate = n_workers * sizeof(void*);
     to_allocate = (to_allocate+cache_line_size-1) & (~(cache_line_size-1));
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     workers = _aligned_malloc(to_allocate, cache_line_size);
     workers_p = _aligned_malloc(to_allocate, cache_line_size);
     workers_memory = _aligned_malloc(to_allocate, cache_line_size);
@@ -1098,7 +1098,7 @@ void lace_stop()
     for (unsigned int i=0; i<n_workers; i++) {
 #if LACE_USE_MMAP
         munmap(workers_memory[i], workers_memory_size);
-#elif defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#elif (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
 	_aligned_free(workers_memory[i]);
 #elif defined(__MINGW32__)
 	__mingw_aligned_free(workers_memory[i]);
@@ -1107,7 +1107,7 @@ void lace_stop()
 #endif
     }
 
-#if defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)
+#if (defined(_MSC_VER) || defined(__MINGW64_VERSION_MAJOR)) && !defined(__CYGWIN__)
     _aligned_free(workers);
     _aligned_free(workers_p);
     _aligned_free(workers_memory);
