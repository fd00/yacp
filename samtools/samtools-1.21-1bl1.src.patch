--- origsrc/samtools-1.21/Makefile	2024-09-13 00:06:19.000000000 +0900
+++ src/samtools-1.21/Makefile	2025-04-01 08:53:10.793386400 +0900
@@ -30,11 +30,6 @@ CFLAGS   = -g -Wall -O2
 LDFLAGS  =
 LIBS     =
 
-LZ4DIR   = ./lz4
-LZ4_CPPFLAGS = -I$(LZ4DIR)
-LZ4_LDFLAGS  = -L$(LZ4DIR)
-
-
 AOBJS=      bam_aux.o bam_index.o bam_plcmd.o sam_view.o bam_fastq.o \
             bam_cat.o bam_md.o bam_plbuf.o bam_reheader.o bam_sort.o \
             bam_rmdup.o bam_rmdupse.o bam_mate.o bam_stat.o bam_color.o \
@@ -45,7 +40,6 @@ AOBJS=      bam_aux.o bam_index.o bam_pl
             bam_quickcheck.o bam_addrprg.o bam_markdup.o tmp_file.o \
             bam_ampliconclip.o amplicon_stats.o bam_import.o bam_samples.o \
             bam_consensus.o consensus_pileup.o reference.o reset.o cram_size.o
-LZ4OBJS  =  $(LZ4DIR)/lz4.o
 
 prefix      = /usr/local
 exec_prefix = $(prefix)
@@ -93,7 +87,7 @@ all: $(PROGRAMS) $(MISC_PROGRAMS) $(TEST
 
 ALL_CPPFLAGS = -I. $(HTSLIB_CPPFLAGS) $(LZ4_CPPFLAGS) $(CPPFLAGS)
 ALL_LDFLAGS  = $(HTSLIB_LDFLAGS) $(LZ4_LDFLAGS) $(LDFLAGS)
-ALL_LIBS     = -lz $(LIBS)
+ALL_LIBS     = -lz $(LIBS) $(LZ4_LIBS)
 
 # Usually config.mk and config.h are generated by running configure
 # or config.status, but if those aren't used create defaults here.
@@ -141,8 +135,8 @@ print-version:
 LIBST_OBJS = sam_opts.o sam_utils.o bedidx.o bam.o
 
 
-samtools: $(AOBJS) $(LZ4OBJS) libst.a $(HTSLIB)
-	$(CC) $(ALL_LDFLAGS) -o $@ $(AOBJS) $(LZ4OBJS) libst.a $(HTSLIB_LIB) $(CURSES_LIB) -lm $(ALL_LIBS) -lpthread
+samtools: $(AOBJS) libst.a $(HTSLIB)
+	$(CC) $(ALL_LDFLAGS) -o $@ $(AOBJS) libst.a $(HTSLIB_LIB) $(CURSES_LIB) -lm $(ALL_LIBS) -lpthread
 
 # For building samtools and its test suite only: NOT to be installed.
 libst.a: $(LIBST_OBJS)
@@ -163,7 +157,7 @@ sam_utils_h = sam_utils.h $(htslib_khash
 sample_h = sample.h $(htslib_kstring_h)
 samtools_h = samtools.h $(htslib_hts_defs_h) $(htslib_sam_h) $(sam_utils_h)
 stats_isize_h = stats_isize.h $(htslib_khash_h)
-tmp_file_h = tmp_file.h $(htslib_sam_h) $(LZ4DIR)/lz4.h
+tmp_file_h = tmp_file.h $(htslib_sam_h) 
 
 bam.o: bam.c config.h $(bam_h) $(htslib_kstring_h)
 bam2bcf.o: bam2bcf.c config.h $(htslib_hts_h) $(htslib_sam_h) $(bam2bcf_h)
@@ -336,7 +330,7 @@ testclean:
 	-cd test/reference && rm -f mpileup.*.fai
 
 mostlyclean: testclean
-	-rm -f *.o misc/*.o test/*.o test/*/*.o version.h $(LZ4OBJS)
+	-rm -f *.o misc/*.o test/*.o test/*/*.o version.h
 
 clean: mostlyclean
 	-rm -f $(PROGRAMS) libst.a $(MISC_PROGRAMS) $(TEST_PROGRAMS)
--- origsrc/samtools-1.21/config.mk.in	2024-09-13 00:06:19.000000000 +0900
+++ src/samtools-1.21/config.mk.in	2025-04-01 08:53:10.793386400 +0900
@@ -53,3 +53,7 @@ HTSLIB_CPPFLAGS = @HTSLIB_CPPFLAGS@
 @Hinstall@HTSLIB_LIB = -lhts
 
 CURSES_LIB = @CURSES_LIB@
+
+LZ4_CPPFLAGS = @LZ4_CPPFLAGS@
+LZ4_LDFLAGS = @LZ4_LDFLAGS@
+LZ4_LIBS = @LZ4_LIBS@
--- origsrc/samtools-1.21/configure.ac	2024-09-13 00:06:19.000000000 +0900
+++ src/samtools-1.21/configure.ac	2025-04-01 08:53:10.793386400 +0900
@@ -144,5 +144,10 @@ esac
 dnl Apply value from HTS_PROG_CC_WERROR (if set)
 AS_IF([test "x$hts_late_cflags" != x],[CFLAGS="$CFLAGS $hts_late_cflags"])
 
+PKG_CHECK_MODULES([LZ4], [liblz4])
+AC_SUBST([LZ4_CPPFLAGS])
+AC_SUBST([LZ4_LDFLAGS])
+AC_SUBST([LZ4_LIBS])
+
 AC_CONFIG_FILES([config.mk])
 AC_OUTPUT
